<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gift Suggestions</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--tg-theme-bg-color, #f5f5f5);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .debug-info {
            margin-bottom: 20px;
            padding: 10px;
            background: var(--tg-theme-secondary-bg-color, #ffffff);
            border-radius: 8px;
            max-width: 360px;
            width: 100%;
        }

        .cards-container {
            position: relative;
            width: 100%;
            max-width: 360px;
            height: 480px;
            margin: 0 auto;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--tg-theme-secondary-bg-color, #ffffff);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: grab;
            transition: transform 0.3s;
            overflow: hidden;
        }

        .card img {
            width: 100%;
            height: 60%;
            object-fit: cover;
            background-color: #e0e0e0;
        }

        .buttons {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            padding: 20px;
        }

        .button {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            background: var(--tg-theme-secondary-bg-color, #ffffff);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .dislike { color: #ff4444; }
        .like { color: #4CAF50; }
    </style>
</head>
<body>
    <div id="debug-info" class="debug-info">Инициализация...</div>
    <div id="cards-container" class="cards-container"></div>
    <div class="buttons">
        <button class="button dislike" onclick="handleDislike()">✕</button>
        <button class="button like" onclick="handleLike()">♥</button>
    </div>

    <script>
        let debug = document.getElementById('debug-info');
        function log(message) {
            debug.innerHTML += '<br>' + message;
            console.log(message);
        }

        // Тестовые данные
        let gifts = [
            {
                name: "Тестовая карточка",
                description: "Это тестовая карточка для проверки работы приложения",
                price: "1990₽",
                image: "https://via.placeholder.com/400x320",
                url: "https://www.ozon.ru"
            }
        ];

        function renderCards() {
            log('Рендеринг карточек...');
            const container = document.getElementById('cards-container');
            container.innerHTML = '';
            
            gifts.forEach((gift, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.style.zIndex = gifts.length - index;
                card.innerHTML = `
                    <img src="${gift.image}" alt="${gift.name}">
                    <div style="padding: 20px;">
                        <h2 style="margin: 0 0 10px 0; font-size: 1.5em;">${gift.name}</h2>
                        <p style="margin: 0; color: #666;">${gift.description}</p>
                        <div style="position:absolute; bottom:20px; right:20px; font-weight:bold;">${gift.price}</div>
                    </div>
                `;
                
                const hammer = new Hammer(card);
                hammer.on('pan', handlePan);
                hammer.on('panend', handlePanEnd);
                
                container.appendChild(card);
                log(`Добавлена карточка: ${gift.name}`);
            });
        }

        function handlePan(event) {
            const card = event.target.closest('.card');
            if (!card) return;
            const xPos = event.deltaX;
            const rotate = xPos / 10;
            card.style.transform = `translateX(${xPos}px) rotate(${rotate}deg)`;
        }

        function handlePanEnd(event) {
            const card = event.target.closest('.card');
            if (!card) return;
            const xPos = event.deltaX;
            if (Math.abs(xPos) > 100) {
                if (xPos > 0) handleLike();
                else handleDislike();
            } else {
                card.style.transform = '';
            }
        }

        function handleLike() {
            const card = document.querySelector('.card');
            if (!card) return;
            card.style.transform = 'translateX(200%) rotate(20deg)';
            setTimeout(() => card.remove(), 300);
        }

        function handleDislike() {
            const card = document.querySelector('.card');
            if (!card) return;
            card.style.transform = 'translateX(-200%) rotate(-20deg)';
            setTimeout(() => card.remove(), 300);
        }

        // Инициализация
        document.addEventListener('DOMContentLoaded', () => {
            log('Страница загружена');
            
            // Проверяем Telegram WebApp
            if (window.Telegram?.WebApp) {
                log('Telegram WebApp найден');
                try {
                    window.Telegram.WebApp.ready();
                    log('Telegram WebApp готов');
                    
                    const webAppData = window.Telegram.WebApp.initData;
                    log('Init data: ' + webAppData);
                    
                    // Если есть данные от бота, используем их
                    if (webAppData) {
                        try {
                            const parsedData = JSON.parse(decodeURIComponent(webAppData));
                            gifts = parsedData;
                            log('Получены данные от бота');
                        } catch (e) {
                            log('Ошибка парсинга данных: ' + e.message);
                        }
                    }
                } catch (e) {
                    log('Ошибка инициализации WebApp: ' + e.message);
                }
            } else {
                log('Telegram WebApp не найден, используем тестовые данные');
            }
            
            renderCards();
        });
    </script>
</body>
</html>
